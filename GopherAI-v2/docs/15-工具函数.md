# 工具函数 (utils/)

## 1. 模块概述

工具函数模块提供项目中使用的通用工具函数，包括加密、UUID 生成、JWT 处理等。

## 2. 文件结构

```
utils/
├── utils.go         # 通用工具函数
└── myjwt/
    └── jwt.go       # JWT 工具
```

## 3. 通用工具 (utils.go)

### 3.1 GetRandomNumbers - 生成随机数字

```go
func GetRandomNumbers(num int) string
```

**功能**: 生成指定位数的随机数字字符串

**示例**: `GetRandomNumbers(11)` → `"12345678901"`

### 3.2 MD5 - MD5 加密

```go
func MD5(str string) string
```

**功能**: 对字符串进行 MD5 加密

**示例**: `MD5("password")` → `"5f4dcc3b5aa765d61d8327deb882cf99"`

### 3.3 GenerateUUID - 生成 UUID

```go
func GenerateUUID() string
```

**功能**: 生成 UUID v4

**示例**: `GenerateUUID()` → `"550e8400-e29b-41d4-a716-446655440000"`

### 3.4 消息转换函数

```go
// schema.Message → model.Message
func ConvertToModelMessage(msg *schema.Message, sessionID, userName string, isUser bool) *model.Message

// model.Message[] → schema.Message[]
func ConvertToSchemaMessages(msgs []*model.Message) []*schema.Message
```

### 3.5 文件操作

```go
// 删除目录下所有文件
func RemoveAllFilesInDir(dir string) error

// 校验文件类型（支持 .md, .txt）
func ValidateFile(file *multipart.FileHeader) bool
```

## 4. JWT 工具 (myjwt/jwt.go)

### 4.1 Claims 结构体

```go
type Claims struct {
    ID       int64  `json:"id"`
    Username string `json:"username"`
    jwt.RegisteredClaims
}
```

### 4.2 GenerateToken - 生成 Token

```go
func GenerateToken(id int64, username string) (string, error)
```

**功能**: 生成 JWT Token

**Token 内容**:
- ID: 用户 ID
- Username: 用户名
- ExpiresAt: 过期时间
- Issuer: 签发者
- Subject: 主题

### 4.3 ParseToken - 解析 Token

```go
func ParseToken(tokenString string) (*Claims, error)
```

**功能**: 解析并验证 JWT Token

**返回**: Claims 或错误

## 5. 使用示例

```go
// 生成用户名
username := utils.GetRandomNumbers(11)

// 密码加密
hashedPassword := utils.MD5("password123")

// 生成会话 ID
sessionID := utils.GenerateUUID()

// JWT 操作
token, _ := myjwt.GenerateToken(1, "12345678901")
claims, _ := myjwt.ParseToken(token)
```

## 6. 依赖关系

```
utils/
├── utils.go
│   ├── → crypto/md5
│   ├── → google/uuid
│   └── → model
│
└── myjwt/jwt.go
    ├── → config
    └── → golang-jwt/jwt/v5
```

## 7. 注意事项

1. **MD5 安全**: MD5 已不安全，生产环境建议使用 bcrypt
2. **JWT 密钥**: 密钥从配置文件读取，需妥善保管
3. **过期时间**: JWT 过期时间配置在 `config.toml`
