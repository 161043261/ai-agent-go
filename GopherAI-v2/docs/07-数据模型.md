# 数据模型 (model/)

## 1. 模块概述

数据模型层定义了与数据库表对应的 Go 结构体，使用 GORM 标签进行 ORM 映射。

## 2. 文件结构

```
model/
├── user.go       # 用户模型
├── session.go    # 会话模型
└── message.go    # 消息模型
```

## 3. 用户模型 (user.go)

```go
type User struct {
    ID        int64          `gorm:"primaryKey" json:"id"`
    Name      string         `gorm:"type:varchar(50)" json:"name"`
    Email     string         `gorm:"type:varchar(100);index" json:"email"`
    Username  string         `gorm:"type:varchar(50);uniqueIndex" json:"username"`
    Password  string         `gorm:"type:varchar(255)" json:"-"`
    CreatedAt time.Time      `json:"created_at"`
    UpdatedAt time.Time      `json:"updated_at"`
    DeletedAt gorm.DeletedAt `gorm:"index" json:"-"`
}
```

| 字段 | 类型 | GORM 标签 | JSON 标签 | 说明 |
|------|------|-----------|-----------|------|
| ID | int64 | primaryKey | id | 自增主键 |
| Name | string | varchar(50) | name | 用户昵称 |
| Email | string | varchar(100), index | email | 邮箱（索引） |
| Username | string | varchar(50), uniqueIndex | username | 用户名（唯一） |
| Password | string | varchar(255) | - (不返回) | 密码（MD5） |
| CreatedAt | time.Time | - | created_at | 创建时间 |
| UpdatedAt | time.Time | - | updated_at | 更新时间 |
| DeletedAt | gorm.DeletedAt | index | - (不返回) | 软删除时间 |

## 4. 会话模型 (session.go)

```go
type Session struct {
    ID        string         `gorm:"primaryKey;type:varchar(36)" json:"id"`
    UserName  string         `gorm:"index;not null" json:"username"`
    Title     string         `gorm:"type:varchar(100)" json:"title"`
    CreatedAt time.Time      `json:"created_at"`
    UpdatedAt time.Time      `json:"updated_at"`
    DeletedAt gorm.DeletedAt `gorm:"index" json:"-"`
}

type SessionInfo struct {
    SessionID string `json:"sessionId"`
    Title     string `json:"name"`
}
```

| 字段 | 类型 | 说明 |
|------|------|------|
| ID | string (UUID) | 主键，36位 UUID |
| UserName | string | 所属用户名（索引） |
| Title | string | 会话标题 |
| CreatedAt | time.Time | 创建时间 |
| UpdatedAt | time.Time | 更新时间 |
| DeletedAt | gorm.DeletedAt | 软删除时间 |

## 5. 消息模型 (message.go)

```go
type Message struct {
    ID        uint      `gorm:"primaryKey;autoIncrement" json:"id"`
    SessionID string    `gorm:"index;not null;type:varchar(36)" json:"session_id"`
    UserName  string    `gorm:"type:varchar(20)" json:"username"`
    Content   string    `gorm:"type:text" json:"content"`
    IsUser    bool      `gorm:"not null" json:"is_user"`
    CreatedAt time.Time `json:"created_at"`
}

type History struct {
    IsUser  bool   `json:"is_user"`
    Content string `json:"content"`
}
```

| 字段 | 类型 | 说明 |
|------|------|------|
| ID | uint | 自增主键 |
| SessionID | string | 所属会话 ID（索引） |
| UserName | string | 发送者用户名 |
| Content | string | 消息内容 |
| IsUser | bool | true=用户消息, false=AI消息 |
| CreatedAt | time.Time | 创建时间 |

## 6. 数据关系

```
User (1) ◄─────── Session (N)
                      │
                      └─────► Message (N)
```

## 7. 注意事项

- Password 和 DeletedAt 字段使用 `json:"-"` 不返回给前端
- Session.ID 使用 UUID 字符串而非自增数字
- Message 不支持软删除（无 DeletedAt）
